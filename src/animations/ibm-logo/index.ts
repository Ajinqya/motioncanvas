import type { AnimationDefinition } from '../../runtime/types';
import { number, color, boolean, folder, select } from '../../runtime/params';

/**
 * IBM Logo Animation
 * Classic 8-bar striped logo with scanline reveal effect
 * Supports both vertical (row-by-row) and horizontal (letter-by-letter) reveal
 */

interface IBMLogoParams {
  // Animation
  animationSpeed: number;
  staggerDelay: number;
  revealDuration: number;
  revealStyle: string;
  revealDirection: string;
  // Colors
  backgroundColor: string;
  stripeColor: string;
  // Effects
  glowIntensity: number;
  glowSize: number;
  // Layout
  scale: number;
  loopAnimation: boolean;
}

// IBM Logo SVG paths organized by stripe row (top to bottom)
// Each stripe row contains multiple path segments for I, B, and M
const stripeRows = [
  // Row 1 (top)
  [
    { d: 'M52.0243 65.1306C61.5562 64.8829 72.1262 65.0501 81.7211 65.1246L81.6566 69.839C71.9643 69.6564 61.7688 69.817 52.0363 69.8163C52.0024 68.2802 52.0256 66.6731 52.0243 65.1306Z' },
    { d: 'M85.7604 65.1243C97.5985 64.8477 109.661 65.1635 121.513 65.152C124.805 65.1489 129.351 67.3119 131.541 69.804C127.133 70.0438 120.824 69.8262 116.2 69.8241L85.7387 69.8077L85.7604 65.1243Z' },
    { d: 'M140.68 65.1233C148.928 64.9503 157.667 65.0841 165.941 65.1207L167.064 69.8492C158.415 69.6917 149.377 69.8197 140.698 69.8158L140.68 65.1233Z' },
    { d: 'M182.624 65.1233C190.907 64.9514 199.661 65.0901 207.966 65.122C207.987 66.373 208.117 68.4908 207.804 69.6258L207.256 69.8322C198.764 69.741 190.131 69.8171 181.628 69.8134C181.891 68.0692 182.197 66.8132 182.624 65.1233Z' },
  ],
  // Row 2
  [
    { d: 'M52 74.1903L81.7187 74.1924L81.7015 78.6048C80.9588 79.2668 55.3831 78.9567 52.0206 78.9499L52 74.1903Z' },
    { d: 'M85.745 74.1814C101.775 74.4403 118.488 74.2695 134.542 74.1799C135.316 76.1519 135.564 76.8572 135.871 78.9539C119.289 79.1239 102.34 79.0121 85.7411 78.9395L85.745 74.1814Z' },
    { d: 'M140.66 74.2245C149.823 74.258 158.987 74.2426 168.149 74.178C168.711 75.9701 168.928 77.1122 169.266 78.94L140.684 78.9491L140.66 74.2245Z' },
    { d: 'M179.943 74.1681C189.288 74.2546 198.633 74.2684 207.977 74.2096C208.002 75.7449 208.049 77.1109 207.889 78.6469L207.47 78.9593L178.78 78.9358C179.021 77.4881 179.565 75.6211 179.943 74.1681Z' },
  ],
  // Row 3
  [
    { d: 'M61.2852 83.1965C65.2132 83.1231 69.3403 83.1933 73.2843 83.2061C73.2922 84.453 73.4596 86.8135 73.0707 87.8529L72.5028 87.9942L60.3941 87.9621C60.3228 86.7751 60.0484 84.3704 60.6164 83.3587L61.2852 83.1965Z' },
    { d: 'M94.1851 83.2182L106.986 83.1811L106.971 87.9551C102.827 88.0841 98.2456 87.983 94.0668 87.9663C94.032 86.4896 93.9109 84.6364 94.1851 83.2182Z' },
    { d: 'M122.475 83.1978C126.958 83.1137 131.494 83.2571 136.003 83.1672C135.92 84.5567 135.953 87.0758 135.071 87.9945L121.316 87.9728C121.237 86.6063 120.919 84.354 121.687 83.3062L122.475 83.1978Z' },
    { d: 'M149.08 83.2093L170.483 83.1999C170.776 84.7568 171.205 86.4603 171.562 88.0175C164.676 87.7495 156.047 87.9752 149.033 87.9713C148.983 86.2012 148.994 84.977 149.08 83.2093Z' },
    { d: 'M177.638 83.203C184.665 83.0441 192.394 83.163 199.442 83.2202C199.481 84.3981 199.696 86.8584 199.231 87.8597L198.638 87.9898L176.596 87.9783C176.907 86.1039 177.141 85.0381 177.638 83.203Z' },
  ],
  // Row 4
  [
    { d: 'M60.3315 92.2852C64.5301 92.1627 69.079 92.2486 73.3063 92.2586L73.2651 97.1509L60.3832 97.1088C60.285 95.5864 60.3294 93.8275 60.3315 92.2852Z' },
    { d: 'M94.0344 92.2596L133.082 92.2296C132.325 93.2066 131.472 94.1462 130.653 95.0757C129.868 95.7188 128.649 96.5289 127.791 97.1344L94.0488 97.1276C93.9952 95.5482 94.0307 93.8489 94.0344 92.2596Z' },
    { d: 'M175.374 92.2465L199.454 92.2761L199.451 97.1441L195.57 97.148L186.615 97.1078C186.693 95.3735 186.597 93.5867 186.536 91.8477C186.181 93.6112 185.8 95.3693 185.392 97.1211C178.535 97.1459 169.297 97.4072 162.589 97.0161C162.352 95.3769 162.169 93.7262 161.927 92.0718C161.796 93.7418 161.59 95.4633 161.414 97.1337L149.031 97.124L149.014 92.2756C157.121 92.2254 165.229 92.2236 173.335 92.2703C173.596 94.1068 173.838 95.787 174.204 97.6115C174.655 95.8079 175.005 94.0658 175.374 92.2465Z' },
  ],
  // Row 5
  [
    { d: 'M60.2999 101.204C64.5011 101.086 69.0575 101.169 73.2854 101.171L73.288 106.071C68.9878 106.089 64.6873 106.071 60.3873 106.017C60.308 104.466 60.3202 102.768 60.2999 101.204Z' },
    { d: 'M94.0192 101.172C105.16 101.175 116.786 100.962 127.884 101.221C130.35 102.933 131.194 103.642 133.053 106.066C120.675 105.752 106.541 106.059 94.0634 106.025C93.9994 104.456 94.0258 102.752 94.0192 101.172Z' },
    { d: 'M149.012 101.187C153.166 101.151 157.32 101.151 161.474 101.186L161.477 106.07L149.03 106.047C149.002 104.45 149.017 102.789 149.012 101.187Z' },
    { d: 'M164.633 101.186L184.047 101.155C183.639 102.535 183.267 104.091 182.899 105.497L182.593 105.947C180.338 106.306 168.64 106.039 165.796 106.015C165.255 104.378 164.976 102.867 164.633 101.186Z' },
    { d: 'M186.713 101.171C190.927 101.117 195.234 101.172 199.455 101.185L199.459 106.053C195.196 106.069 190.933 106.058 186.67 106.021L186.713 101.171Z' },
  ],
  // Row 6
  [
    { d: 'M60.3182 110.359C64.5667 110.266 69.0275 110.333 73.2925 110.336L73.2421 115.131C68.9617 115.154 64.6813 115.123 60.402 115.038C60.2939 113.553 60.3252 111.863 60.3182 110.359Z' },
    { d: 'M94.048 110.379C98.2074 110.244 102.787 110.333 106.98 110.341L106.951 115.111C102.652 115.134 98.3539 115.11 94.0561 115.039C93.9999 113.526 94.0394 111.901 94.048 110.379Z' },
    { d: 'M119.335 110.363C124.726 110.3 130.116 110.3 135.507 110.364C135.737 112.105 135.859 113.359 135.962 115.112C130.496 115.12 124.805 115.203 119.36 115.024C119.292 113.532 119.332 111.87 119.335 110.363Z' },
    { d: 'M149.019 110.368C153.115 110.284 157.369 110.336 161.478 110.337C161.502 111.893 161.582 113.569 161.377 115.102C157.26 115.081 153.142 115.084 149.025 115.11C149.003 113.542 149.02 111.94 149.019 110.368Z' },
    { d: 'M167.272 110.342L181.3 110.355C180.798 112.31 180.657 112.7 179.755 114.556C179.712 114.736 179.54 114.874 179.39 115.044C177.341 115.291 170.82 115.132 168.414 115.12L167.272 110.342Z' },
    { d: 'M186.706 110.325C190.956 110.311 195.206 110.32 199.456 110.352C199.474 111.919 199.43 113.551 199.41 115.123C195.171 115.13 190.932 115.106 186.692 115.049L186.706 110.325Z' },
  ],
  // Row 7
  [
    { d: 'M52.0376 119.467L81.6683 119.436L81.7025 124.13L52.006 124.105L52.0376 119.467Z' },
    { d: 'M85.7745 119.454L135.867 119.453C135.593 121.149 135.331 121.894 134.777 123.514L134.574 123.956C134.201 124.168 90.3228 124.07 85.7291 124.11L85.7745 119.454Z' },
    { d: 'M140.725 119.444L161.454 119.438L161.481 124.137C154.538 124.063 147.593 124.04 140.649 124.067L140.725 119.444Z' },
    { d: 'M169.871 119.505L178.203 119.425C177.937 120.843 177.517 122.145 177.102 123.522L176.735 124.017C175.401 124.273 172.567 124.149 171.102 124.13C170.577 122.478 170.256 121.175 169.871 119.505Z' },
    { d: 'M186.725 119.449L207.917 119.432L207.967 124.119C201.003 123.962 193.668 124.079 186.683 124.112C186.664 122.582 186.707 120.984 186.725 119.449Z' },
  ],
  // Row 8 (bottom)
  [
    { d: 'M52.0032 128.865L81.7169 128.871L81.7109 133.171C73.1379 133.584 60.8828 133.203 52.0037 133.183L52.0032 128.865Z' },
    { d: 'M85.7586 128.879L131.655 128.841L128.538 130.874C122.575 134.124 116.185 133.243 109.543 133.234L85.7314 133.171L85.7586 128.879Z' },
    { d: 'M140.671 128.871L161.487 128.875L161.461 133.209L140.669 133.167L140.671 128.871Z' },
    { d: 'M173.091 128.908C174.177 128.882 174.321 128.708 175.189 129.191C175.46 130.052 174.87 131.32 174.552 132.248L174.319 132.438C173.621 131.821 173.257 129.883 173.091 128.908Z' },
    { d: 'M186.675 128.875L207.958 128.862L207.949 133.204L186.682 133.169L186.675 128.875Z' },
  ],
];

// IBM Logo paths organized by letter columns (left to right: I, B, M-left, M-right)
// For horizontal reveal animation
const letterColumns = [
  // Column 0: Letter "I" (x: 52-82)
  [
    { d: 'M52.0243 65.1306C61.5562 64.8829 72.1262 65.0501 81.7211 65.1246L81.6566 69.839C71.9643 69.6564 61.7688 69.817 52.0363 69.8163C52.0024 68.2802 52.0256 66.6731 52.0243 65.1306Z' },
    { d: 'M52 74.1903L81.7187 74.1924L81.7015 78.6048C80.9588 79.2668 55.3831 78.9567 52.0206 78.9499L52 74.1903Z' },
    { d: 'M61.2852 83.1965C65.2132 83.1231 69.3403 83.1933 73.2843 83.2061C73.2922 84.453 73.4596 86.8135 73.0707 87.8529L72.5028 87.9942L60.3941 87.9621C60.3228 86.7751 60.0484 84.3704 60.6164 83.3587L61.2852 83.1965Z' },
    { d: 'M60.3315 92.2852C64.5301 92.1627 69.079 92.2486 73.3063 92.2586L73.2651 97.1509L60.3832 97.1088C60.285 95.5864 60.3294 93.8275 60.3315 92.2852Z' },
    { d: 'M60.2999 101.204C64.5011 101.086 69.0575 101.169 73.2854 101.171L73.288 106.071C68.9878 106.089 64.6873 106.071 60.3873 106.017C60.308 104.466 60.3202 102.768 60.2999 101.204Z' },
    { d: 'M60.3182 110.359C64.5667 110.266 69.0275 110.333 73.2925 110.336L73.2421 115.131C68.9617 115.154 64.6813 115.123 60.402 115.038C60.2939 113.553 60.3252 111.863 60.3182 110.359Z' },
    { d: 'M52.0376 119.467L81.6683 119.436L81.7025 124.13L52.006 124.105L52.0376 119.467Z' },
    { d: 'M52.0032 128.865L81.7169 128.871L81.7109 133.171C73.1379 133.584 60.8828 133.203 52.0037 133.183L52.0032 128.865Z' },
  ],
  // Column 1: Letter "B" (x: 85-136)
  [
    { d: 'M85.7604 65.1243C97.5985 64.8477 109.661 65.1635 121.513 65.152C124.805 65.1489 129.351 67.3119 131.541 69.804C127.133 70.0438 120.824 69.8262 116.2 69.8241L85.7387 69.8077L85.7604 65.1243Z' },
    { d: 'M85.745 74.1814C101.775 74.4403 118.488 74.2695 134.542 74.1799C135.316 76.1519 135.564 76.8572 135.871 78.9539C119.289 79.1239 102.34 79.0121 85.7411 78.9395L85.745 74.1814Z' },
    { d: 'M94.1851 83.2182L106.986 83.1811L106.971 87.9551C102.827 88.0841 98.2456 87.983 94.0668 87.9663C94.032 86.4896 93.9109 84.6364 94.1851 83.2182Z' },
    { d: 'M122.475 83.1978C126.958 83.1137 131.494 83.2571 136.003 83.1672C135.92 84.5567 135.953 87.0758 135.071 87.9945L121.316 87.9728C121.237 86.6063 120.919 84.354 121.687 83.3062L122.475 83.1978Z' },
    { d: 'M94.0344 92.2596L133.082 92.2296C132.325 93.2066 131.472 94.1462 130.653 95.0757C129.868 95.7188 128.649 96.5289 127.791 97.1344L94.0488 97.1276C93.9952 95.5482 94.0307 93.8489 94.0344 92.2596Z' },
    { d: 'M94.0192 101.172C105.16 101.175 116.786 100.962 127.884 101.221C130.35 102.933 131.194 103.642 133.053 106.066C120.675 105.752 106.541 106.059 94.0634 106.025C93.9994 104.456 94.0258 102.752 94.0192 101.172Z' },
    { d: 'M94.048 110.379C98.2074 110.244 102.787 110.333 106.98 110.341L106.951 115.111C102.652 115.134 98.3539 115.11 94.0561 115.039C93.9999 113.526 94.0394 111.901 94.048 110.379Z' },
    { d: 'M119.335 110.363C124.726 110.3 130.116 110.3 135.507 110.364C135.737 112.105 135.859 113.359 135.962 115.112C130.496 115.12 124.805 115.203 119.36 115.024C119.292 113.532 119.332 111.87 119.335 110.363Z' },
    { d: 'M85.7745 119.454L135.867 119.453C135.593 121.149 135.331 121.894 134.777 123.514L134.574 123.956C134.201 124.168 90.3228 124.07 85.7291 124.11L85.7745 119.454Z' },
    { d: 'M85.7586 128.879L131.655 128.841L128.538 130.874C122.575 134.124 116.185 133.243 109.543 133.234L85.7314 133.171L85.7586 128.879Z' },
  ],
  // Column 2: Letter "M" left leg (x: 140-175)
  [
    { d: 'M140.68 65.1233C148.928 64.9503 157.667 65.0841 165.941 65.1207L167.064 69.8492C158.415 69.6917 149.377 69.8197 140.698 69.8158L140.68 65.1233Z' },
    { d: 'M140.66 74.2245C149.823 74.258 158.987 74.2426 168.149 74.178C168.711 75.9701 168.928 77.1122 169.266 78.94L140.684 78.9491L140.66 74.2245Z' },
    { d: 'M149.08 83.2093L170.483 83.1999C170.776 84.7568 171.205 86.4603 171.562 88.0175C164.676 87.7495 156.047 87.9752 149.033 87.9713C148.983 86.2012 148.994 84.977 149.08 83.2093Z' },
    { d: 'M149.014 92.2756C157.121 92.2254 165.229 92.2236 173.335 92.2703C173.596 94.1068 173.838 95.787 174.204 97.6115C174.655 95.8079 175.005 94.0658 175.374 92.2465L199.454 92.2761L199.451 97.1441L195.57 97.148L186.615 97.1078C186.693 95.3735 186.597 93.5867 186.536 91.8477C186.181 93.6112 185.8 95.3693 185.392 97.1211C178.535 97.1459 169.297 97.4072 162.589 97.0161C162.352 95.3769 162.169 93.7262 161.927 92.0718C161.796 93.7418 161.59 95.4633 161.414 97.1337L149.031 97.124' },
    { d: 'M149.012 101.187C153.166 101.151 157.32 101.151 161.474 101.186L161.477 106.07L149.03 106.047C149.002 104.45 149.017 102.789 149.012 101.187Z' },
    { d: 'M164.633 101.186L184.047 101.155C183.639 102.535 183.267 104.091 182.899 105.497L182.593 105.947C180.338 106.306 168.64 106.039 165.796 106.015C165.255 104.378 164.976 102.867 164.633 101.186Z' },
    { d: 'M149.019 110.368C153.115 110.284 157.369 110.336 161.478 110.337C161.502 111.893 161.582 113.569 161.377 115.102C157.26 115.081 153.142 115.084 149.025 115.11C149.003 113.542 149.02 111.94 149.019 110.368Z' },
    { d: 'M167.272 110.342L181.3 110.355C180.798 112.31 180.657 112.7 179.755 114.556C179.712 114.736 179.54 114.874 179.39 115.044C177.341 115.291 170.82 115.132 168.414 115.12L167.272 110.342Z' },
    { d: 'M140.725 119.444L161.454 119.438L161.481 124.137C154.538 124.063 147.593 124.04 140.649 124.067L140.725 119.444Z' },
    { d: 'M169.871 119.505L178.203 119.425C177.937 120.843 177.517 122.145 177.102 123.522L176.735 124.017C175.401 124.273 172.567 124.149 171.102 124.13C170.577 122.478 170.256 121.175 169.871 119.505Z' },
    { d: 'M140.671 128.871L161.487 128.875L161.461 133.209L140.669 133.167L140.671 128.871Z' },
    { d: 'M173.091 128.908C174.177 128.882 174.321 128.708 175.189 129.191C175.46 130.052 174.87 131.32 174.552 132.248L174.319 132.438C173.621 131.821 173.257 129.883 173.091 128.908Z' },
  ],
  // Column 3: Letter "M" right leg (x: 176-208)
  [
    { d: 'M182.624 65.1233C190.907 64.9514 199.661 65.0901 207.966 65.122C207.987 66.373 208.117 68.4908 207.804 69.6258L207.256 69.8322C198.764 69.741 190.131 69.8171 181.628 69.8134C181.891 68.0692 182.197 66.8132 182.624 65.1233Z' },
    { d: 'M179.943 74.1681C189.288 74.2546 198.633 74.2684 207.977 74.2096C208.002 75.7449 208.049 77.1109 207.889 78.6469L207.47 78.9593L178.78 78.9358C179.021 77.4881 179.565 75.6211 179.943 74.1681Z' },
    { d: 'M177.638 83.203C184.665 83.0441 192.394 83.163 199.442 83.2202C199.481 84.3981 199.696 86.8584 199.231 87.8597L198.638 87.9898L176.596 87.9783C176.907 86.1039 177.141 85.0381 177.638 83.203Z' },
    { d: 'M186.713 101.171C190.927 101.117 195.234 101.172 199.455 101.185L199.459 106.053C195.196 106.069 190.933 106.058 186.67 106.021L186.713 101.171Z' },
    { d: 'M186.706 110.325C190.956 110.311 195.206 110.32 199.456 110.352C199.474 111.919 199.43 113.551 199.41 115.123C195.171 115.13 190.932 115.106 186.692 115.049L186.706 110.325Z' },
    { d: 'M186.725 119.449L207.917 119.432L207.967 124.119C201.003 123.962 193.668 124.079 186.683 124.112C186.664 122.582 186.707 120.984 186.725 119.449Z' },
    { d: 'M186.675 128.875L207.958 128.862L207.949 133.204L186.682 133.169L186.675 128.875Z' },
  ],
];

// Easing functions
const easeOutQuart = (t: number): number => 1 - Math.pow(1 - t, 4);
const easeOutCubic = (t: number): number => 1 - Math.pow(1 - t, 3);

const animation: AnimationDefinition<IBMLogoParams> = {
  id: 'ibm-logo',
  name: 'IBM Logo Reveal',
  fps: 60,
  durationMs: 4000,
  width: 520,  // 2x the SVG for better resolution
  height: 396, // Maintains 260:198 ratio (close to 4:3)
  background: '#000000',

  params: {
    defaults: {
      animationSpeed: 1,
      staggerDelay: 0.11,
      revealDuration: 0.8,
      revealStyle: 'wipe',
      backgroundColor: '#000000',
      stripeColor: '#ffffff',
      glowIntensity: 0.3,
      glowSize: 8,
      scale: 0.5,
      loopAnimation: true,
    },
    schema: {
      ...folder('Animation', {
        animationSpeed: number({ value: 1, min: 0.25, max: 3, step: 0.25, label: 'Speed' }),
        revealDirection: select({
          value: 'vertical',
          options: ['vertical', 'horizontal'],
          label: 'Direction',
        }),
        staggerDelay: number({ value: 0.08, min: 0.02, max: 0.3, step: 0.01, label: 'Stagger Delay' }),
        revealDuration: number({ value: 0.4, min: 0.1, max: 1, step: 0.05, label: 'Reveal Duration' }),
        revealStyle: select({
          value: 'scanline',
          options: ['scanline', 'wipe', 'fade', 'scale'],
          label: 'Reveal Style',
        }),
        loopAnimation: boolean({ value: true, label: 'Loop' }),
      }),
      ...folder('Colors', {
        backgroundColor: color({ value: '#000000', label: 'Background' }),
        stripeColor: color({ value: '#FCFCFC', label: 'Stripe Color' }),
      }),
      ...folder('Effects', {
        glowIntensity: number({ value: 0.3, min: 0, max: 1, step: 0.1, label: 'Glow Intensity' }),
        glowSize: number({ value: 8, min: 0, max: 30, step: 2, label: 'Glow Size' }),
      }),
      ...folder('Layout', {
        scale: number({ value: 1, min: 0.5, max: 2, step: 0.1, label: 'Scale' }),
      }),
    },
  },

  render({ ctx, time, width, height, params }) {
    const {
      animationSpeed,
      staggerDelay,
      revealDuration,
      revealStyle,
      revealDirection,
      backgroundColor,
      stripeColor,
      glowIntensity,
      glowSize,
      scale,
      loopAnimation,
    } = params;

    // Clear background
    ctx.fillStyle = backgroundColor;
    ctx.fillRect(0, 0, width, height);

    // Calculate animation progress
    const adjustedTime = time * animationSpeed;
    const totalDuration = 4; // seconds
    const loopTime = loopAnimation ? adjustedTime % totalDuration : Math.min(adjustedTime, totalDuration);

    // Select groups based on direction
    const isHorizontal = revealDirection === 'horizontal';
    const groups = isHorizontal ? letterColumns : stripeRows;

    // Calculate total animation time for all groups
    const numGroups = groups.length;
    const totalStaggerTime = staggerDelay * (numGroups - 1) + revealDuration;

    // Center and scale the logo
    const centerX = width / 2;
    const centerY = height / 2;

    ctx.save();
    ctx.translate(centerX, centerY);
    ctx.scale(scale * 2, scale * 2); // 2x because we doubled canvas size
    ctx.translate(-130, -99); // Center of original 260x198 viewBox

    // Draw each group with animation
    groups.forEach((group, groupIndex) => {
      // Calculate timing for this group
      const startTime = groupIndex * staggerDelay;
      let groupProgress = 0;

      if (loopTime >= startTime) {
        groupProgress = Math.min((loopTime - startTime) / revealDuration, 1);
        groupProgress = easeOutCubic(groupProgress);
      }

      if (groupProgress > 0) {
        group.forEach((pathData) => {
          ctx.save();

          // Apply reveal effect based on style and direction
          let alpha = 1;
          let pathScale = 1;

          switch (revealStyle) {
            case 'scanline':
              // Fade in with offset based on direction
              alpha = groupProgress;
              ctx.globalAlpha = alpha;
              if (groupProgress < 1) {
                if (isHorizontal) {
                  // Horizontal: slide in from left
                  ctx.translate((1 - groupProgress) * -10, 0);
                } else {
                  // Vertical: slide down from top
                  ctx.translate(0, (1 - groupProgress) * -3);
                }
              }
              break;

            case 'wipe':
              // Wipe reveal using clip
              ctx.beginPath();
              if (isHorizontal) {
                // Vertical wipe (top to bottom) for horizontal stagger
                const clipHeight = 200 * groupProgress;
                ctx.rect(0, 0, 260, clipHeight);
              } else {
                // Horizontal wipe (left to right) for vertical stagger
                const clipWidth = 260 * groupProgress;
                ctx.rect(0, 0, clipWidth, 200);
              }
              ctx.clip();
              break;

            case 'fade':
              // Simple fade in
              alpha = easeOutQuart(groupProgress);
              ctx.globalAlpha = alpha;
              break;

            case 'scale':
              // Scale in from center of each path
              pathScale = easeOutQuart(groupProgress);
              alpha = groupProgress;
              ctx.globalAlpha = alpha;
              break;
          }

          // Add glow effect
          if (glowIntensity > 0 && glowSize > 0 && groupProgress > 0.5) {
            const glowProgress = (groupProgress - 0.5) * 2;
            ctx.shadowColor = stripeColor;
            ctx.shadowBlur = glowSize * glowIntensity * glowProgress;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
          }

          // Draw the path
          const path = new Path2D(pathData.d);
          ctx.fillStyle = stripeColor;

          if (revealStyle === 'scale' && pathScale < 1) {
            // For scale effect, scale around logo center
            const pathCenterX = 130;
            const pathCenterY = 99;
            ctx.translate(pathCenterX, pathCenterY);
            ctx.scale(pathScale, pathScale);
            ctx.translate(-pathCenterX, -pathCenterY);
          }

          ctx.fill(path);

          // Double draw for stronger glow
          if (glowIntensity > 0.5 && glowSize > 0 && groupProgress > 0.7) {
            ctx.shadowBlur = glowSize * glowIntensity * 0.5;
            ctx.fill(path);
          }

          ctx.restore();
        });
      }
    });

    ctx.restore();

    // Add scanline/sweep overlay effect for extra tech feel
    if (revealStyle === 'scanline' && loopTime < totalStaggerTime + 0.2) {
      const progress = loopTime / totalStaggerTime;
      
      if (isHorizontal) {
        // Vertical sweep line for horizontal reveal
        const scanlineX = progress * width;
        const gradient = ctx.createLinearGradient(scanlineX - 20, 0, scanlineX + 5, 0);
        gradient.addColorStop(0, 'rgba(255, 255, 255, 0)');
        gradient.addColorStop(0.5, `rgba(255, 255, 255, ${0.1 * glowIntensity})`);
        gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
        ctx.fillStyle = gradient;
        ctx.fillRect(scanlineX - 20, 0, 25, height);
      } else {
        // Horizontal sweep line for vertical reveal
        const scanlineY = progress * height;
        const gradient = ctx.createLinearGradient(0, scanlineY - 20, 0, scanlineY + 5);
        gradient.addColorStop(0, 'rgba(255, 255, 255, 0)');
        gradient.addColorStop(0.5, `rgba(255, 255, 255, ${0.1 * glowIntensity})`);
        gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
        ctx.fillStyle = gradient;
        ctx.fillRect(0, scanlineY - 20, width, 25);
      }
    }
  },
};

export default animation;
