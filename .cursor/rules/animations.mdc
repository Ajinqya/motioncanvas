---
description: Animation creation conventions for Motion Graphics project
globs: src/animations/**/*.ts
alwaysApply: true
---

# Animation Creation Rules

## Location
- **Always** create animations directly in `src/animations/{animation-id}/`
- **Never** use the draft folder - create in gallery immediately
- Each animation needs: `index.ts` + `meta.json`

## Canvas Sizes (Aspect Ratios Only)

Use ONLY these aspect ratios:

| Ratio | Example Sizes |
|-------|---------------|
| 1:1   | 400×400, 500×500, 800×800 |
| 16:9  | 1920×1080, 1280×720, 960×540 |
| 9:16  | 1080×1920, 720×1280, 540×960 |
| 4:3   | 800×600, 1024×768, 640×480 |
| 3:4   | 600×800, 768×1024, 480×640 |

## Animation Structure Template

```typescript
import type { AnimationDefinition } from '../../runtime/types';
import { number, color, boolean, folder, select } from '../../runtime/params';

interface MyAnimationParams {
  // Layout
  scale: number;
  // Colors
  primaryColor: string;
  backgroundColor: string;
  // Animation
  speed: number;
}

const animation: AnimationDefinition<MyAnimationParams> = {
  id: 'my-animation',
  name: 'My Animation',
  fps: 60,
  durationMs: 3000,
  width: 400,   // Use valid aspect ratio
  height: 400,
  background: '#FFFFFF',

  params: {
    defaults: {
      scale: 1,
      primaryColor: '#000000',
      backgroundColor: '#FFFFFF',
      speed: 1,
    },
    schema: {
      ...folder('Layout', {
        scale: number({ value: 1, min: 0.1, max: 3, step: 0.1, label: 'Scale' }),
      }),
      ...folder('Colors', {
        primaryColor: color({ value: '#000000', label: 'Primary Color' }),
        backgroundColor: color({ value: '#FFFFFF', label: 'Background' }),
      }),
      ...folder('Animation', {
        speed: number({ value: 1, min: 0.1, max: 3, step: 0.1, label: 'Speed' }),
      }),
    },
  },

  render({ ctx, width, height, progress, params }) {
    const { scale, primaryColor, backgroundColor, speed } = params;
    
    // Apply speed to progress
    const adjustedProgress = (progress * speed) % 1;
    
    // Clear background
    ctx.fillStyle = backgroundColor;
    ctx.fillRect(0, 0, width, height);

    // Center and scale content
    ctx.save();
    ctx.translate(width / 2, height / 2);
    ctx.scale(scale, scale);
    
    // Draw centered at (0, 0)
    ctx.fillStyle = primaryColor;
    ctx.beginPath();
    ctx.arc(0, 0, 50 * adjustedProgress, 0, Math.PI * 2);
    ctx.fill();
    
    ctx.restore();
  },
};

export default animation;
```

## Required Parameters

Always include these in your params:

```typescript
// Layout folder with scale - ALWAYS required
...folder('Layout', {
  scale: number({ value: 1, min: 0.1, max: 3, step: 0.1, label: 'Scale' }),
}),

// Colors folder for customization
...folder('Colors', {
  primaryColor: color({ value: '#000000', label: 'Primary Color' }),
  backgroundColor: color({ value: '#FFFFFF', label: 'Background' }),
}),
```

## Key Points

1. **Use `progress` (0→1)** - goes from 0 to 1 over the animation duration
2. **Center with translate** - use `ctx.translate(width / 2, height / 2)` then draw at (0, 0)
3. **Always save/restore** - wrap transforms in `ctx.save()` / `ctx.restore()`
4. **Expose key values as params** - colors, scale, speed, etc. for easy tweaking

## Canvas Best Practices

```typescript
// Good: Use beginPath before drawing shapes
ctx.beginPath();
ctx.arc(0, 0, radius, 0, Math.PI * 2);
ctx.fill();

// Good: Save/restore around transforms
ctx.save();
ctx.translate(x, y);
ctx.rotate(angle);
// draw...
ctx.restore();

// Good: Use progress for timing
const scale = 0.5 + 0.5 * progress;  // 0.5 → 1.0
const opacity = Math.min(1, progress * 2);  // fade in first half
```

## Common Easing Functions

```typescript
// Define these outside render for reuse
const easeOutCubic = (t: number) => 1 - Math.pow(1 - t, 3);
const easeInOutQuad = (t: number) => t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2;

// Use in render
const easedProgress = easeOutCubic(progress);
```

## After Creating Animation

1. Update `src/animations/registry.ts` to import and register the new animation
2. Create `meta.json` with id, name, createdAt, source, prompt, and tags
